package types

import (
	"testing"

	"github.com/ethereum/go-ethereum/common"
	"github.com/stretchr/testify/require"
)

func TestClientState(t *testing.T) {
	ethProof := Proof{
		Address:     "0xf06ba39bce333442dfa477e313d6439ac7dc89c4",
		Balance:     "0x0",
		CodeHash:    "0x3181dce94575ba559796b3fe2444355c0109fa240dce2af4c434911c4e55368f",
		Nonce:       "0x1",
		StorageHash: "0x8dfdcb81c4ecb59a58736a5a685215e653402d45d1a86e05b666dde741812b7a",
		AccountProof: []string{
			"0xf90211a0bfd9712822b2bc1b42a339cde37c557cbc7b5cb57681efd2a672950a71b6fb91a00c27c413a4f6c5e480098e7015c3b682c905b2c3d69ffd0ee350ec018dcd25a2a0910340d2587d52c8f9d23d352530f08f6050401d0a146d10b93fa5d9212b82f6a0cf447145b78feb6b8128a992c2515200f3731c894f03684518a1b57c01346b38a0aef560bd8e77141d8609a9fcdc2b6ac340ad8510c692dba17bf0c439db4e78d5a0398f8fe3bf5ae865da1b38a06070e5a35f34827853987f7039ad7a22fddd65dfa003645e1ad5b61c0715eee5a18d03421e00b7fba3fd04503469f10b8f31ed1f71a0c9d86ad1238bf35253700135ddb8b28dd27596566ce4505e3be50cca282f2357a0b31e007840b8df2bdb53442df707d61fb0d0c87c090c2382f30ef609628c3587a0c79c5b4acb051352c84dfe2a21be9475cad8015bb9b175c303a1b926e3a03890a0a9de7a451a0c5824280c1957d19c46f9691b5343c91161de8c95f2bfaae8334ca07b09f002331890efebbd96bb2b160e2d7290480f79df95ba6273683deda46befa0add631e2586397e610da49549e34b76aa120db702ff22f517c3d785468c0a285a0534238f7501a6a0f5aa3513198f59eac1cffd450fb375f8555d389dab8ba16dba0ec91aca65abd0ba2d0148b604950d9808c8415c3238cdccc2d0c55936d51e076a06dcbe66baa6852867b7f45e5f3b16fd4b4accdc502e87dd096c96d5897c5a69980",
			"0xf90211a0d9deeaaf3a34a474146aba6b0f02ff1fd2412923b3883e40f2164d2e51e0e0b6a0cf6d013fbf1773b57c429d7f5531c15e70caea5fc8b430f0d82e81467f0c133ca06b896eeaf640b2b461babeeb69c096515d4ed9e19543605c57c13d77da177265a0289ff7cd34a401b0f0877477c201ed54553d49af3165db7134939b1f46f56be3a0077c2c41b8144f2e7698d15bd8c80f1b106d3e172e092532c8af935791a144a3a0bff27a80a6bbd075bbb7f457fbccea171380bc1685b59737089d433d4e934c44a07be70ee25c1b247c3c29c02bd0143c442acd9a100a035345d90c839634830603a067bba6995f16ecb72507f105ee2ac76bebc3a16597e229ce763c5bc8fa3f662ba06f4d9971a8ad8b0641b2952d0c21aa36fea390fbaa7adbc50c1799e534946b26a03d1ad4d07e1c070ae33ea7fef1016b2b3fb29babe94cc23488b9844b0296fac1a0c938845f800c15c76fcc3623a037cea8d26784d5b6b9a0a832e24d7e79b4f9e3a06d9384be488a0d325408aee59875065f8476e1965d2bf5dd8306e349d75f6011a0d130bd753693baac85dc7ba2f06b92996a57d37663a0bcb0b010b8577028c1a2a012a3fc73a6e3a12ecf88e1f383227756350a2b71ad0160cf9b77c28d58a53799a0d6b3f0b38d58111d9cc8a8f2d40c3b75d27816aa706ab33d79746c2814f1e182a023c15efb048fcd3f193db04a7de6778a548e8dd759e3d260ce4e4b1f51ba7b1080",
			"0xf90211a0eef3cb90aa719c72fa8105a1cd7b152c6283199288afe4e0fcc515827a6af63aa0d27ec2b1855f94f471ccb7e41ed506fc402e01110715cef1041c5783fc6c4259a000a5b320cbabc341caa191d2e908bcb1579af7d787f8942018a5f8b74d04386da034fcccfb5bedacdd808f3170f859523a14aaf01b01d8beb481450472e8af4751a074f9f1a816b6d0282b4251313e6d29080317da5a2ef6cb1d9e9a2f9e9b7d84bfa0c27a7d37a29d2e7e6aaac37e0d575f01f00cb20ddff6285836ea53278da3eb70a00d0d049a017729fcfe2467a359cd65d73857394930852c6317fb6a51215136bea00e3eb3c748ea5d86c3f72723f9e92f6d21159d4fc24a5a2ed7070a18b9032b8ba09f20647405557e902cdea0d54c0cf3073d90824c1da63ed3595d453188e81087a0d74dc1f3995f2fd6916b2033d2a257c93004c98f14c86bd00ba60494bbc564f9a004f73ef80926d23b12c8c8a222e526b490cdcab9be3e9388ccaedf2d42ccbfaea024e8a25c805d39135cf3427675b743340673fc9d8d3bc5d24522ce803552d9aba0e518f133ecc6db7c758acc9832c512580d01a6cbae7a17e77a6d763a5159a5b4a017b57453513108304eb9966ef7dd96d15a9c971252cc0ae9bd952c4822d2221aa05cce3102b5522577cfb98c4209e01d3cb2fe383bfd71ed3cd024731eec0b2849a01298c28cb9627c5b5511fa7e7b6a6b6d26e4085b2d2a69240298beecd49a586780",
			"0xf90211a0f68a9c716ee016cd6f2a93b9d8121132f15210e3f2e909ef5e3196c29d28dbdca076066cd59025c6215a193d4a23a2356d0fdac216c3aa9243c125c02db6510356a00ff22c290a815198307a5beb509eac6a82928c5bc92be7c338c48b5879edebf0a07b7ae39751b5e9b0fecf9838a247a85f4f3152a1f77ddca84d3a06219d7d8679a0f81bf6611f8d05cfc0fc47f4aaaaca4517ff995741fb76e1f94f95bb4761391ca0b1fb9b396248bdba8ae1b9f2615d19386bb2be5ca1aace029622f664f32ec19da0f68c398ccf776fcb2e95a983ca851f1b7d9afb4e4c49e0b97754ea02f87ab05ba000af6521bfdeb495ae8a87eb783b150c7b8cc5257e35da8f7e99d560dd1a07c3a0b8fc21c7068b1ce928fdf6008f5cbbdb6230e6cc2572feae16dd9a886450eb79a00d49d6e299689327fa15f0f6ba3595078880998f09da24f56a8b5680964d0e2ca0a591fa886e2be33af509c445ad82d0d7fc69d9b39978c9b96a3bfa712bde5715a00ba82beb56669d2c5ef7fc627796e11b548b13567f3a39ab2702a0cb96114b0ba0da55260f0ad0d565aeea2d9642e1cf68016f40cc3c1debe94c5d4f7cc0b6088da0f67f1a84a7c0bf5fc4d7f7382acfe42686d58efe5d8bcc86c35270c77ee04993a0aa1535f0698e9a92f3ca7813b88726abeee6a6c06f9c39760639992f57a97c3ca02f6cccf04e8df114a3fe5ee4ebaff601ba2077e7df403dd50cde8b8597df587480",
			"0xf90211a079dac3bed2ff32a7878b220b3bb33b3f6f9e1be562c128c0eec4c22114e592f7a0dfe89f7cc7442b4cc7541552dc3f23402682554f0f6ac5040866f6cdcc42705aa0f168197cb77a1a4c82dfd66ab025dd89dbed6ff890993d2e3c11669f4c1051c5a0c5ac29573bb556004c469dd4b55f2144c6e73d5b9e3af7a0fea4ebb2b43140cba056dacc3bdc62886cf716b124b76205977f54ed05201ebac0d7de5ffb2528fb74a0594390da9fa4c74cb1757ca12d4ec7b3ad1f162d910764600536017eaf2fd261a092367d056b0ec47d4814ce44ba44c699d5902e995c317f407f056a4938b0d14fa03f1e6e3004787061e64372a02611e2b506be3d51d46994fddd30acdfee7c40f7a0db06b473cf81a1d0bfb92e674734c687a06dd4a074b55d2d60a4a0699214e3eea03d04cbd0f0205657d0097f90b5a55a557be98829a18d09ce2144234808b3b800a00e916e6a977ad55233cc6feab3b73448da85cc04804ab7bc4713401637c9321ca06ffe1f1604b38530367501fe1fd509c9ee580a1653202d9dcad90c2a6fd31d33a09441ce9a2645925a51b24c496f777248e40d1b35e3e3690cd33e09d8f8712c12a0ca8b565b4ef1ce8303e4618e152dea9e321c1ee26d80e1669e82c69be558da77a073241031a035c97dacadf6f124ea1ff791a325dffa3d56f4a5b3e46e7a7d63d5a01134fd0901dfeb7dc3dae5fc5e4cc95dfa91c9b555bc9ca249aaf34fa14453f880",
			"0xf901f1a03613d2206ddf2f61a5ee5504bebacdd3e470582d6e79c3035042e6fa11df4c3ca0ff1269e3d36b2f600b3d8da3e73ae073dc07a51637d3eda1b5cdfc714785591c80a0886db97859315539ef70bc316248464eff2e121d5b708216364df9720685a5afa0753833c6d55c212f0f5d0d3e41762bce8b90f061a2c7404a9ab70bc7061d0962a006b937fc39f8be95a600ca6afe39af051cea580b1a5611d987a8a9a9281dd6c4a0bab24e9116726c8243be0a4c416611070e4933f26f4f3b5a53d334d2ec19a52ea088f993d41885cc8c01cfb1d4aa75e494da1cd6f4f4f5072caee82c054ed375daa05b9fb0ef42d834616ab8f44498e1aa4ca24c323ad452066a0cef554c014f2a8ea05bbf1cd2902311941952b2882dafaca816d158765f0a921271e97de4c7a8c251a0f9a42acdd310702c9a187dab498a374b3fe06fdfd0e7d5d58eeba2b0f3625240a046eecbc3fc79c9d1e484841a454398fb72fb66c18f7d6601a4469a9276ec7479a06399bde24fb546465acca0dc11eb49430473078de7d2ce2348af04746a1ad838a07cc2cb4a007c3bbb5b256a59de0ab989d9c228cbb7e77b6768a564b9a593608ca0d2375ecace67c3d0033814d8966b9888eec8dadb8f9e7275d30fcd51d263aaf9a056169cc546774adb1f96fd2b392a5c18f3cb51e01cae19b5dbce17ca169c0cd980",
			"0xf871808080a0e837dadd9b809ba83d9558aad329c6c9701eb2ee014cf69b354626f70fcca04da0055310416260c943523794763361dd1f99dfca6e3d5e8466845b860b9529511480a0902bbf16a5624812217e5dc91b665859c721520f97b68db3a6fdf52302354d1580808080808080808080",
			"0xf8669d36768e186c66b23b088223251c73c4310260ae75240a41530c9be04ca8b846f8440180a08dfdcb81c4ecb59a58736a5a685215e653402d45d1a86e05b666dde741812b7aa03181dce94575ba559796b3fe2444355c0109fa240dce2af4c434911c4e55368f",
		},
		StorageProof: []*StorageResult{
			{
				Key:   "0x3829cc87a3c046c32497e345a2381d814a5b64d1045efda46d5eef091557fa5a",
				Value: "0x0",
				Proof: []string{"0xf901d1a005407ff76c246e297730110496092ff3c9e6bc4dc3005bb1a0cbde8df78b1c4480a05d477198c9d4bb3c616d6036abc8afb308f8285928d7d108d70a6d6e7dbb3f23a0ccffc07965384cfe1ae506aa23c6ca440b21bee01c189cf06e9277f6ec104c4da00d8e53aef7568a4098a450fa58ea65d03cc09aaad17db3fc3d9a0850308e11b8a005017f3e58d8b1597c25fc87f57eff2355c3efab1216ac603a7e7e94fdd7710ca0a3ed4cd924b0bf76dcd55bf2b0da9f6bbf953bebfe2d6a567103d92be0ae77aa80a091360d4e1744ded571f3c7e4528ea82d28f689414a51f8fda184f0aff1601beea0dc7f839e4bad5dbbe97528896506b970a66526f5feaf2beed30ae86884fdaf98a0c843fafcfea66d737b654513c33d162b30018a5ee4c2768f5f021a119da32d37a002b3462900740466259673a2b6f161976514bb0ae3d8a679932889f129ccb2d1a0d94faa93d88300860293d422d43bf18edeb2ac495879bce80a9b80d9aa1cf97da07fa2b58bfd8a0503a39bbdce18f8f16212f1d17587a5b0ab3a3e0a170cd907a1a0cb80f15850e26ae0234467a0f0681e1409266213efbce4d7ec4543d4c0cfda68a04d6affc1723fbb8740d323aecb18f41f12c467aa0da5a2b8a8e25d8c029d883580",
					"0xf871a038f56fd59fd830b9c3109b8b26f6161109880d9dcc7c0f71187911b382a8c8d4808080a0df64235d862da0c4bf9c96dd0362c1b8194c02f4a8313b8d556f8cc28c77d9aa80a04b382e45701f84998d31c781d86bb587aaf90d0dfc10141a2caa1db7cfc4b43b80808080808080808080"},
			},
		},
	}

	verified := verifyMerkleProof(ethProof,
		&ConsensusState{
			Root: common.FromHex("0x4878c3d76488e996658b533cfa5b9cf7bb8d039ceddfa510ad98ff7820916698"),
		},
		common.FromHex("0xf06ba39bce333442dfa477e313d6439ac7dc89c4"),
		common.FromHex("0x0"),
		common.FromHex("0x3829cc87a3c046c32497e345a2381d814a5b64d1045efda46d5eef091557fa5a"),
	)
	require.NoError(t, verified)
}
