package types

import (
	"testing"

	"github.com/ethereum/go-ethereum/common"
	"github.com/stretchr/testify/require"
)

func TestClientState(t *testing.T) {
	ethProof := Proof{
		Address:      "0x6c2d2868487665C766740ec4cAD006110CfDCff8",
		Balance:      "0x0",
		CodeHash:     "0xdd9728085d2436b7c77cf322cdf8dad5f0a6f8315f44073c7f305d5b5544bb13",
		Nonce:        "0x1",
		StorageHash:  "0x0ba6f17854e43c971a3cf6619a6a5a1c3ea2502b6951057dfaa2a1a37939e458",
		AccountProof: []string{"0xf90211a094ed0d3d9ee0f19e7eb950291246810735c1eb80e1c6c671ecaee883d3142419a0645921de8e79f543f21481948fd2863f77489474926d8de7b0e8ba24d7d4009da00f9b330965c7075f8d05e335336f37a42653997d24fa7a7de15672ed32cd4ecea075a6a5754fd112ce4a5e6158c472ccf6115994cab1f6841a2eda9055443f288ea030eda29764a99b289a8937d22a089435dabc264111c71ed4b8fe82946373438ba02373b3ff6db0890410cf11e771de67ea2e626c58be1de6114f00428264216533a056130882a5e0ea4de9b74d9f3b063c772b03db48d326429fa960e6cabaff6244a0c323f18260e6e02a774fa720fc8a157d7f8e4e6f834889d8ee408fb21df9a145a080f0c121153371fd39a5018069499f99f518915b12d9367c8e1032625e595767a0da269555edd262df4b62e32a3745599cf6ad9cba27f46c92f02623d37c273d8aa03511a23c41bdff6b6697f90e1470bfea856839708245587647f8fc91746b40b8a05872cee09ea9f84681f2fe3e4ac38d590f09ca969364c5c6e08b268ce3536f59a085a00f7f74be2685e431d258ed355a24f4abfe53713e7e52a8661badf4754ffaa04eeabe92e174edf1ade9b2e7b5f4b741149d1a3ec4276007b38e449a2116fbdca05e4697525ccd5ee08030385535202fa1067c6a00856ca4c6417396afe67aeab2a088e5a612489070a75ba824e7fc5b47ae56073611494dcc6c4e80bbbb8dc7fb5180", "0xf90211a093b5dd6fb22fcaa691df55664375861fa1eea1113085e0238702e242a07bb00fa073097d4e7fe638b2a92d9448198bdee97278a30a236c086d222bf5464736b5b8a0aec7b9492d53059362fa7ed7dc0d6ebd1bb5cd5a9b2c7ad8c373d44478910d0ea0c4abd6ed3b9ce1668d9f74e40a83f751768d525ab1a4eb55c0d50fa37730a1a1a082c294be2304887e7b9183717b2903d698151dce2a039e23503aa74ab53c774ca06b29a93436e4e6a459d17b9703c850ca48710621725c9cad08c173265a1557d4a02e2caadf5280df66b5c7d22fa421d99aaf0a903e68971ed5db847170d6037231a0d96b4fa0f132f2c3ed10ea6ba2e9429914cc787988f56d4c1e0e244165dd46dea0286fd51b0238ff4d42e4a3ff9e5fa05498b9047725d43ba111bfa9982d84cb63a0482cd08b7dec235e96ec2c07dd995fc5dacd392837c4d9814dacd74d837773b1a0d0f06436bbf3016be2e5a6669b1d140b326acad26cb555a8335c88b1694c928ea031e6233820aaca91c9d12e63daa8a3aac1002bc27ab6a38d9e737dfbd8e774cda0085b21456dae5c5d330fe3f405ffae039df4b0b60a3ad71241910ccfcb73847ca0cd8e0551dfc238d4dba5099023caa99614f83a154f8e92a542ee4ed02db91705a008b37fa5f2b518727bebe5db4f916df5f9894de0b5c122d46433ad7e546fc92ba0155dad0b69b865b790b7641a265927190afec28d9032a6c1ba7b6f221ce6f41d80", "0xf90211a0644804703c60f9d73592ae5045457f54e6c0c93e9bd0f3264be4d12219057dfba0ed518f6b445a972d96bcc4fff4c5a68cd731f39efc3acb4caa5e1b28d09f0eb4a036e9eba63da4f0fc48a6269f0caae0cfd97df7a9b6c18c03c8d0b17f0de442cba05f97d15e4ad2743e717cbaa5833c9f900da7bcce9445ce7f480c0157362669aaa01cde9f5fcce4057c14192ec6089c5e11ece65aadd7c2a3671193453ed2b183d8a0a550a2fff3b3a25c368e42840b0480cf686c547cf5d2603f4d943d56fcf93ce8a0e72e1b4c8b87e9cb04ba6f789afd54d4cc79def6f708eaff7a218f1a19a266fba052069057ed6a3be231a3afd9bb8a7b19c4ab0f46d9f00180d861aedfc45dba17a02b43f014c2a3f500e6f330b590f40b79d7147cf67cce33e2178bbe9eb2e74d14a012699e92913fbfb8eac8987ec7fe7117fe5f86285667c9cdde0132b99c2a010ba03a2badbf5441c1f1cd4d15c5f11de958ecf0048aa1e89c21bd074fba8484b8f2a08902a57d77eef45ad631afaaa99259fb476160a45fbc2fcc21239c62acaeda24a08f2c4f40b4d66668db99c97fd01eeb7bb5c374bb29bbd83fc3f1f814ac8fca9ba03059bb33c261df0a829af90e86b32bc3fa68e6e115a665259fdc521321964777a044166cb136f5babf3c8f61460aac4f748c411df784273bad97054acee5f7e25da078212ee1950f8e8170e4d59086fa64fcfdd85e621ae98fcf529312252500a21f80", "0xf90211a06ac9d1344fbaa2b8f26f4516ce984b9dd7dd4b7b2ef8593d068ef785274c9517a0c0efd7071e7e9a8efeef620052fccdad694912792edf0379722e5672f09f300fa0a239dffde56887704ca3167583435ce386bc3c38177867788981b538ad9ca7eea0767d4e3be9a302dcf6c17a703aae44c79adeb6b35b18ad4a8e0c10a195bbed46a03230cc1b5a92198b22c2408eaa9acb00a46302401f112599462f11b4bbe49bbda019ea7944baaa8655fd9c9d1f47c3488f239983bf5d5f1c42d295f69cf65cf668a0af18d357fd6e0b63a2edaf90794be35d875935028e0a040ee63858871c3ad585a0a9d065f77206eff384c6b91e00773c9c6509d1572a41491c3ffe11583a4cdfeca0a955fbc4d565fba3894322861bf5056474e7246814d9ab4a8eaa4c6ac8023967a0cb7d9f739047be468b87f621d424856e354a3135e6fa06001fb2d60d9a1afc61a04d351e4a30da0a7ede6b7f064e566faa934bc7dd83ae55dbf22d942e0605bc61a07b1c1b8c70ba55382449cfa4d83a2e1ad13fd98f7b2eed4e703cd2643c0ea852a065a65641a459a90904604e645d20b5c36bcf67cb6de790c3591e1808986dbb7da0e18ce8d42b9ba7fdaca6098048d2eaf26bfb8678a4c3f63f937216d63468eeb3a0e72677b5d46ff1a1e938b7a528d6b4a7581a06854938237850bf083d92b31b0ca0915b8cc1455fb16ba74031be8ae871e855253a355b1e240bad11eabd68c3893c80", "0xf90211a03b908d2c7cba72ac45b20e45d50a4ba7d4ee568498d7d3e3a9a8704651105c4ba064e2da41ff0c60a0d5bc7187822674ebb854fe1d5563f45c8d212eaab86f13aaa0ba14413527ba6a3e718f2a30abf14e06d6961202d933f34bdf551723640e9348a0ea751402e095fea2a282d0f3764fbd1ef26524bb23860c1faa010bab4311a0e5a0d4dd210af8cbd39c686b480d31e8bf1f1269422c057200e581e2243c6b861486a0be83f765121beea16d4f25515a06531d1ad891cc6e849c6dc9a2ddfd5371963da03ef13c1223fa05c9d9ea3ce959b3627ce93207ec879a28cd5abfae69c53dba3ea0ebb19b05e6215504c8551ae217ff75b2bc32ec7f4cd7142306cb672f55c8e659a02f8e1d015a3fece8a5c169f31e33feb47c6b40417fc52aa4fd638dae263cc164a0036738461090a5f948d61dc214cc39c1f9b53ac2216bbbc2c6211a6a4b06e8cba06af6d96d0ffb83b1a68972570f86095ed6d4e9f88c4dc950f176170662528dbba0d6ce700187e0bd4067e0bc4062a995346557e8519eac3ba705bff12595b2078ea076b6add1ac74823f51fc6e0b8dc5a34d8268633bd00ab16944431b7c37428458a0c676d389d666001c7f6a52aab5b3e4e75248a3fe18df824c5d93cef626b201a5a03f89996fddf37dca8d0c37f3e5b58c86d4fa187096de1424511765101bae32dea0104985940c55c857d9c16cbbea6308d488158db84429d902ee7ae5cfc57576f380", "0xf901b1a0443046a6e5abaa059047cc20a72a6060b1498b52f2ca6d3a42ce276366e50b68a082befc9233c38bec1d3d41387dc37d5007cf13eb2718cb8f0e24b4b9bb097d8b80a0762fbcef44c2047aa55fe91a5c18827e5bfa74b69ea8e67e50697a7d918998eea0a3cd204dc199d5bed998db70ea92dde2f2cbce92c3a9c042dac43730cdfa1562a0c55fd01f942e9d6314262d9e1d187e52f9baf8d3ec842a1952bf193413923e19a009087b75972dc2587fbdf7dff3830a448734df3c9a9fa7094f2f893d65d7eadea0b7713804f3d0ec14d792b194aabb3619dc55de1b8c01d013cb8cfa605417385ea0d5530a3d1dfb4386e4070ccd6a24c4625bcdff34e5f196d50618c4c799ad1495a08e4fbcb2f9b2ed24a78caa9b4bfd6afda391219d2792aeab82305a319fb89fcda0dbc4a5d51f139e73e2923fd63a723ec5219d8ea4d2602b4b86ff16dd69735b6380a04855332e6112a3e3d4677b8f7ea726a26f29b4149edd7c2a7f93b2c3777e5816a03ab372606e75cdf5a232baf8e6a180b8bee86fd747f1623fdd614809e98899e1a0c6352306f7cd3cb0632d717110666fe4cb2bc0c9a751776a54a6c53000b0a4b18080", "0xf8518080808080a0f19f10eaadef5a7f05f514a765a478938f1bd061f7067f75fb62c2a8632058b0a045e3c73c357a2c8bcf0f10cdcc02bcc477aba31d749770c22c3714c0dbf0d36980808080808080808080", "0xf851808080808080808080a05d779626ca08cb36491c6af268d8d0027dde054df05b42432172de51a002fbbc808080a052460ed1ff2984a83930fb11cd81b9b4fc61add91439a3bd96f448f580fba5e5808080", "0xf8669d207e5302e50a938423f0684e8034a5cdb9ad095bbdb06f7bb144c1ee60b846f8440180a00ba6f17854e43c971a3cf6619a6a5a1c3ea2502b6951057dfaa2a1a37939e458a0dd9728085d2436b7c77cf322cdf8dad5f0a6f8315f44073c7f305d5b5544bb13"},
		StorageProof: []*StorageResult{
			{
				Key:   "0x45214ccccece088a5cb038304c5bc854ce3a8a20422ef406af531e24d3e987f5",
				Value: "0xe2e240ed1d7b1ee6be77e9101b573c90800cf8d61d6eff892f9d7d987ccc3383",
				Proof: []string{
					"0xf90111a0fc03d53af862a984c407b3336468ccf70d43203b9c0ae694f1debfb79117b07f80a0d7b88267348c1d47aac1e550a12488b338186b1781624cc21c83590a7fd7ce6380a077b748bdae68dbd9b56be79701c5169c15428c64ecc75b303a4770e5f1573490808080a096dba94eb35fc1a9cf3dc1d24790a3f77c0934b4da9abfc5067f4ca8c0dabdc680a09a6c70570794fe8d93b485df93c5e5bca4cd0b5af7ad8484b82d44fb99961b2ca0eda4c6dad4b96f89078289820ce7afc011d7dd5ad1bdfd0cb7f1a582501c260c8080a0ccd24db5d5e5aa298396f775ffb90cf4e08b62c6a29a6d7504a53baeb4dc40b2a018bb41a708c96f217473a62cb453ddee64d7e339221d935404bb895fd326599d80",
					"0xf891a0cc56220df498f3eb2d550d2c4d9d7b7d3758ff1facee972629a2e16cc7d2525a80808080a049afce1d7aef3f0eb9d309638fbc599f2c30b390c7c26672452ed07b81f29da88080a008486848a27452422156605cc7f1f0d35b3dcf25601edc98944e5d7532176683808080808080a0a1662049ba3dd419a6b2b27de39b1a9fb84a73739e1dbd7eecf586723b8f2a2a80",
					"0xf843a020a64e2a337d882dadcb444881f3233910fa19382c2502a954b27a35a872f72ea1a0e2e240ed1d7b1ee6be77e9101b573c90800cf8d61d6eff892f9d7d987ccc3383",
				},
			},
		},
	}

	verified := verifyMerkleProof(ethProof,
		&ConsensusState{
			Root: common.FromHex("29cbc44fbbaa4e3953d218d82a412117eb4648ffd789fe429b613acc020f14c8"),
		},
		common.FromHex("0x6c2d2868487665C766740ec4cAD006110CfDCff8"),
		common.FromHex("0xe2e240ed1d7b1ee6be77e9101b573c90800cf8d61d6eff892f9d7d987ccc3383"),
		common.FromHex("0x45214ccccece088a5cb038304c5bc854ce3a8a20422ef406af531e24d3e987f5"),
	)
	require.NoError(t, verified)
}
